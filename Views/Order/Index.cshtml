@model List<Jallikattu.Models.CartItem>

@{
    ViewBag.Title = "Order Summary";
    decimal total = Model.Sum(x => x.Price * x.Quantity);
}

<h3 class="mb-4 pt-4 text-center">Your Order Summary</h3>

<table class="table table-bordered text-center">
    <thead>
        <tr>
            <th>Qty</th>
            <th>Product</th>
            <th>Price</th>
            <th>Total</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>@item.Quantity</td>
                <td>@item.ProductName</td>
                <td>₹@item.Price</td>
                <td>₹@(item.Price * item.Quantity)</td>
            </tr>
        }
    </tbody>
    <tfoot>
        <tr>
            <td colspan="2"></td>
            <td><strong>Total:</strong></td>
            <td><strong>₹@total</strong></td>
        </tr>
    </tfoot>
</table>

<div class="row mt-4">
    <div class="col-md-6">
        <a href="@Url.Action("Products","Home")"
           class="btn btn-outline-secondary">
            ← Add more items
        </a>
    </div>

    <div class="col-md-6">
        <div class="d-flex flex-column align-items-md-end align-items-stretch gap-2 pe-5  pt-2">

            <!-- Google Pay -->
            <button id="rzp-button" 
                    class="btn btn-dark w-md-auto">
                Pay with Google Pay
            </button>

            <!-- PayPal -->
            <div id="paypal-btn"
                 class="w-100"
                 style="max-width: 200px;">
            </button>

        </div>
    </div>
</div>

</table>

<hr />

@section Scripts {

    <!-- PAYPAL -->
    <script src="https://www.paypal.com/sdk/js?client-id=Aao5LYxwtsSdLSvwxs4dOcIjAtgfuL_F7wlCxz-L3HmtncPOsW9rCzJOz5p6XsNrJGZ_JIReDWK6XPyB&currency=USD"></script>

    <script>
        paypal.Buttons({
            createOrder: function (data, actions) {
                return actions.order.create({
                    purchase_units: [{
                        amount: {
                            value: '@total'
                        }
                    }]
                });
            },
            onApprove: function (data, actions) {
                return actions.order.capture().then(function (details) {
                    window.location.href = '/Order/CompleteOrderPaypal';
                });
            },
            onError: function (err) {
                alert("PayPal payment failed");
                console.error(err);
            }
        }).render('#paypal-btn');
    </script>

    <!-- RAZORPAY (GOOGLE PAY) -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

    <script>
        var options = {
            "key": "YOUR_RAZORPAY_KEY",
            "amount": "@(total * 100)", // paise
            "currency": "INR",
            "name": "Jallikattu GPS",
            "description": "Order Payment",
            "handler": function (response) {
                window.location.href = '/Order/CompleteOrderGPay';
            }
        };

        var rzp = new Razorpay(options);
        document.getElementById('rzp-button').onclick = function (e) {
            rzp.open();
            e.preventDefault();
        };
    </script>
    <style>
        @@media (min-width: 768px) {
    .w-md-auto {
        width: auto !important;
    }
}

    </style>
}
